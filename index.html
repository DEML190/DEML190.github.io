<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dog Ai - identify your dog's breed online</title>
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="assets/css/style.css">
    <link rel="icon" href="assets/img/favicon.ico" type="image/x-icon">
    <script src="page-transitions/js/jquery-3.2.1.js"></script>

    <style>
        flydog {
            width: 200px;
            height: 200px;
            background: url(assets/img/bollon.png);
            position: absolute;
            left: 0;
            top: 0;
        }
    </style>


    <script>
        var socket;

        function init() {
            var host = "ws://120.76.143.58:9813/";
            try {
                socket = new WebSocket(host);
                socket.onopen = function (msg) {
                    log("远程主机连接成功!");
                };
                socket.onmessage = function (msg) {
                    // log(msg.data);
                    details = eval(msg.data);
                    showResult(details);
                    showImage(details)
                };
                socket.onclose = function (msg) {
                    log("连接断开！如需继续请按刷新");
                };

            }
            catch (ex) {
                log(ex);
            }
            $("msg").focus();


            // show results
            function showImage(){
                downImgUrl = details;
            }
            function showResult() {
                //js循环读取json数据
                var table = document.getElementById("table");
                var row = table.insertRow(table.rows.length);
                var c1 = row.insertCell(0);
                var c2 = row.insertCell(1);
                c1.innerHTML = "";
                c2.innerHTML = "";
                for (var i = 0; i < 5; i++) {
                    var row = table.insertRow(table.rows.length);
                    var c1 = row.insertCell(0);
                    c1.innerHTML = details[i].prob;
                    var c2 = row.insertCell(1);
                    c2.innerHTML = details[i].breed;
                };
                log("恭喜！识别结果出来了，你的狗狗品种将显示在右方：→");
                log(" ")
            };
            // set the flying dog
            var oDiv = document.body.children[0];
            var iSpeedX = 1;
            var iSpeedY = 1;

            setInterval(function () {
                var l = oDiv.offsetLeft + iSpeedX;
                var t = oDiv.offsetTop + iSpeedY;

                if (t > document.documentElement.clientHeight - oDiv.offsetHeight) {
                    t = document.documentElement.clientHeight - oDiv.offsetHeight;
                    iSpeedY *= -1;
                }
                if (l > document.documentElement.clientWidth - oDiv.offsetWidth) {
                    l = document.documentElement.clientWidth - oDiv.offsetWidth;
                    iSpeedX *= -1;
                }

                if (t < 0) {
                    t = 0;
                    iSpeedY *= -1;
                }
                if (l < 0) {
                    l = 0;
                    iSpeedX *= -1;
                }

                oDiv.style.left = l + 'px';
                oDiv.style.top = t + 'px';
            }, 16);
        }

        function send() {
            var txt, msg;
            txt = $("msg");
            msg = txt.value;
            if (!msg) {
                alert("Message can not be empty");
                return;
            }
            txt.value = "";
            txt.focus();
            try {
                socket.send(msg);
                log("图片成功上传至服务器！正在进行智能识别... ...")
            } catch (ex) {
                log(ex);
            }
        }

        window.onbeforeunload = function () {
            try {
                socket.send('quit');
                socket.close();
                socket = null;
            }
            catch (ex) {
                log(ex);
            }
        };

        function $(id) {
            return document.getElementById(id);
        }
        function log(msg) {
            $("log").innerHTML += "<br>" + msg;

        }
        function onkey(event) {
            if (event.keyCode == 13) {
                send();
            }
        }
    </script>

</head>

<body onload="init()">

    <!-- set the flying dog -->
    <!-- <flydog></flydog> -->

    <div class="bgimg"></div>
    <div id="log">
        <div>【Terminal】</div>
        <div class="show">
            <table id="table">
                <tr>
                    <th>[概率]_______</th>
                    <th>_______[品种]</th>
                </tr>
            </table>
        </div>
    </div>
    <br>
    <input id="msg" type="textbox" onkeypress="onkey(event)" />
    <button onclick="send()">发送</button>
    <input type=button value=刷新 onclick="location.replace(location)">
    <br>
    <br>
    <div>请在上方表格框输入或粘贴图片URI，点击【发送】即可获得识别结果；若有错误，请按【刷新】</div>
    <br>
    <br>
    <div class="Copyright">Copyright © 2022 lhfeng Admin</div>

</body>

</html>